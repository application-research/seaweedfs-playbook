---
# Install SeaweedFS
- name: Check out seaweedfs
  ansible.builtin.git:
    repo: https://github.com/application-research/seaweedfs
    dest: /usr/local/src/seaweedfs
    version: 3.51

- name: Compile SeaweedFS
  ansible.builtin.make:
    chdir: /usr/local/src/seaweedfs
    target: weed
    mode: "0755"

- name: Install SeaweedFS
  ansible.builtin.copy:
    src: /usr/local/src/seaweedfs/weed
    dest: /usr/local/bin/weed
    owner: root
    group: root
    mode: "0755"

- name: Ensure the SeaweedFS config directory exists
  ansible.builtin.file:
    path: /etc/seaweedfs
    mode: "0755"
    owner: root
    group: root
    state: directory

# - name: Install security config for SeaweedFS
#   ansible.builtin.template:
#     src: security.toml.j2
#     dest: /etc/seaweedfs/security.toml
#     owner: root
#     group: root
#     mode: "0644"
